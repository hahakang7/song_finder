<div th:fragment="authModal" id="loginModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:9999;">
    <div style="background:white; width:320px; margin:120px auto; padding:18px; border-radius:10px;">
        <h3 style="margin-top:0;">로그인이 필요합니다</h3>
        <p style="font-size:14px; color:#555;">보호된 기능입니다. 먼저 로그인해 주세요.</p>

        <form action="/auth/google-login" method="post" style="margin-bottom:8px;">
            <input type="hidden" name="redirect" id="loginRedirect" value="/">
            <button type="submit" style="width:100%; padding:8px;">Google 소셜 로그인 (더미)</button>
        </form>

        <button type="button" onclick="alert('회원가입은 준비 중입니다. (더미)')" style="width:100%; padding:8px; margin-bottom:8px;">회원가입 (더미)</button>
        <button type="button" onclick="window.closeLoginModal()" style="width:100%; padding:8px;">닫기</button>
    </div>
</div>

<script th:fragment="authScript" th:inline="javascript">
    const isAuthed = /*[[${isAuthed}]]*/ false;
    const shouldOpenModal = /*[[${showLoginModal}]]*/ false || window.location.search.includes('loginRequired=1');

    function openLoginModal() {
        const modal = document.getElementById('loginModal');
        const redirect = document.getElementById('loginRedirect');
        if (!modal || !redirect) return;
        redirect.value = window.location.pathname + window.location.search;
        modal.style.display = 'block';
    }

    function closeLoginModal() {
        const modal = document.getElementById('loginModal');
        if (!modal) return;
        modal.style.display = 'none';
    }

    window.openLoginModal = openLoginModal;
    window.closeLoginModal = closeLoginModal;

    document.addEventListener('DOMContentLoaded', function () {
        if (!isAuthed && shouldOpenModal) {
            openLoginModal();
        }

        document.querySelectorAll('[data-protected="true"]').forEach((el) => {
            const eventName = el.tagName === 'FORM' ? 'submit' : 'click';
            el.addEventListener(eventName, function (e) {
                if (isAuthed) return;
                e.preventDefault();
                openLoginModal();
            });
        });
    });
</script>
